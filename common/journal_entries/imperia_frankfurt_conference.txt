# Content Added to Mod
# Catto6's Section
je_imperia_frankfurt_conference = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	# Voting Starting Options
	scripted_button = je_frankfurt_conference_vote_republic_button
	scripted_button = je_frankfurt_conference_vote_monarchy_button
	# Who gets to vote in Germany?
	scripted_button = je_frankfurt_conference_vote_oligarchy_button
	scripted_button = je_frankfurt_conference_vote_wealth_button
	scripted_button = je_frankfurt_conference_vote_universal_button
	# Optional round - presidential or parliamentary republic
	scripted_button = je_frankfurt_conference_vote_presidential_button
	scripted_button = je_frankfurt_conference_vote_parliamentary_button
	# Claims
	scripted_button = je_frankfurt_conference_lesser_germany_button
	scripted_button = je_frankfurt_conference_greater_germany_button
	scripted_button = je_frankfurt_conference_greater_austria_button
	# Optional round - revolution? Only for universal suffrage republics
	scripted_button = je_frankfurt_conference_internal_focus_button
	scripted_button = je_frankfurt_conference_external_focus_button
	# Austria / Prussia leaves voting
	scripted_button = je_frankfurt_conference_leave_button
	is_shown_when_inactive = {
		OR = {
			country_has_primary_culture = cu:north_german
			country_has_primary_culture = cu:south_german
		}
	}
	possible = {
		any_country = {
			filter = {
				OR = {
					country_has_primary_culture = cu:north_german
					country_has_primary_culture = cu:south_german
				}
			}
			has_technology_researched = nationalism
			percent >= 0.75
		}
	}
	immediate = {
		# This section pops at the start of the Conference. Used to initialise stuff, like variables
		# Only does so for the owner of Frankfurt, just to be sure
		if = {
			limit = {
				this = p:x11C0A0.owner
			}
			set_global_variable = {
				name = frankfurt_conference_voting_period
				value = 0
			}
			set_global_variable = {
				name = frankfurt_conference_current_vote
				value = 1
			}
			# This one is just initialised here, will be "populated" on completion
			set_global_variable = {
				name = frankfurt_eligible_german_leader_voters
				value = 0
			}
			
		}
	}
	fail = {
		custom_tooltip = {
			text = left_frankfurt_conference_tt
			has_variable = left_frankfurt_conference
		}
	}
	current_value = {
		value = global_var:frankfurt_conference_voting_period
	}
	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					this = p:x11C0A0.owner
				}
				change_global_variable = {
					name = frankfurt_conference_voting_period
					add = 1
				}
				## If the voting has run for 12 weeks, start over with a new vote category
				if = {
					limit = {
						global_var:frankfurt_conference_voting_period >= 12
					}
					set_global_variable = {
						name = frankfurt_conference_voting_period
						value = 0
					}
					change_global_variable = {
						name = frankfurt_conference_current_vote
						add = 1
					}
					if = {
						limit = {
							# The presidential/parliamentary debate only takes place if republic and wealth voting won
							OR = {
								frankfurt_conference_has_majority_for_republic = no
								frankfurt_conference_has_majority_for_wealth = no
							}
							global_var:frankfurt_conference_current_vote = 3
						}
						# Skip it if those 2 are NOT true
						change_global_variable = {
							name = frankfurt_conference_current_vote
							add = 1
						}
					}
					if = {
						limit = {
							# The revolutionary focus debate only takes place if republic and universal voting won
							OR = {
								frankfurt_conference_has_majority_for_republic = no
								frankfurt_conference_has_majority_for_universal = no
							}
							global_var:frankfurt_conference_current_vote = 5
						}
						# Skip it if those 2 are NOT true
						change_global_variable = {
							name = frankfurt_conference_current_vote
							add = 1
						}
					}
				}
			}
		}
	}
	complete = {
		# Complete on voting round 7, round 6 is the last chance for countries to leave
		custom_tooltip = {
			text = frankfurt_conference_is_over_tt
			global_var:frankfurt_conference_current_vote = 7
		}
	}
	on_complete = {
		change_global_variable = {
			name = frankfurt_eligible_german_leader_voters
			add = 1
		}
		p:x11C0A0.owner = {
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_1
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_2
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_3
				value = 0
			}
			# Get 3 big German powers, probably Prussia, Austria and Bavaria?
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
				}
				order_by = gdp
				position = 1
				set_variable = first_candidate_german_leader
			}
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
				}
				order_by = gdp
				position = 2
				set_variable = second_candidate_german_leader
			}
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
				}
				order_by = gdp
				position = 3
				set_variable = third_candidate_german_leader
			}
		}
		trigger_event = {
			id = frankfurt_conference.1
			days = 3
		}
	}
	goal_add_value = {
		add = 12
	}
	progressbar = yes
	weight = 5000
	should_be_pinned_by_default = yes
}
