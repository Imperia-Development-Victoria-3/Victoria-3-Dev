je_imperia_frankfurt_parliament = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	# Voting Starting Options
	scripted_button = je_frankfurt_parliament_vote_republic_button
	scripted_button = je_frankfurt_parliament_vote_monarchy_button
	# Who gets to vote in Germany?
	scripted_button = je_frankfurt_parliament_vote_oligarchy_button
	scripted_button = je_frankfurt_parliament_vote_wealth_button
	scripted_button = je_frankfurt_parliament_vote_universal_button
	# Optional round - presidential or parliamentary republic
	scripted_button = je_frankfurt_parliament_vote_presidential_button
	scripted_button = je_frankfurt_parliament_vote_parliamentary_button
	# Claims
	scripted_button = je_frankfurt_parliament_lesser_germany_button
	scripted_button = je_frankfurt_parliament_greater_germany_button
	scripted_button = je_frankfurt_parliament_greater_austria_button
	# Optional round - revolution? Only for universal suffrage republics
	scripted_button = je_frankfurt_parliament_internal_focus_button
	scripted_button = je_frankfurt_parliament_external_focus_button
	# Leave the conference, wont be pressed to join the new Germany
	scripted_button = je_frankfurt_parliament_leave_button
	is_shown_when_inactive = {
		OR = {
			country_has_primary_culture = cu:north_german
			country_has_primary_culture = cu:south_german
		}
	}
	possible = {
		any_country = {
			filter = {
				OR = {
					country_has_primary_culture = cu:north_german
					country_has_primary_culture = cu:south_german
				}
			}
			has_technology_researched = nationalism
			percent >= 0.75
		}
	}
	immediate = {
		# This section pops at the start of the Conference. Used to initialise stuff, like variables
		# Only does so once
		trigger_event = {
			# Announcement
			id = frankfurt_parliament.4
			popup = yes
		}
		if = {
			limit = {
				NOT = {
					exists = global_var:frankfurt_parliament_voting_period
				}
			}
			set_global_variable = {
				name = frankfurt_parliament_voting_period
				value = 0
			}
			set_global_variable = {
				name = frankfurt_parliament_current_vote
				value = 1
			}
			# This one is just initialised here, will be "populated" on completion
			set_global_variable = {
				name = frankfurt_eligible_german_leader_voters
				value = 0
			}
		}
	}
	fail = {
		custom_tooltip = {
			text = left_frankfurt_parliament_tt
			has_variable = left_frankfurt_parliament
		}
	}
	current_value = {
		value = global_var:frankfurt_parliament_voting_period
	}
	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					this = p:x11C0A0.owner
				}
				change_global_variable = {
					name = frankfurt_parliament_voting_period
					add = 1
				}
				## If the voting has run for 12 weeks, start over with a new vote category
				if = {
					limit = {
						global_var:frankfurt_parliament_voting_period >= 12
					}
					set_global_variable = {
						name = frankfurt_parliament_voting_period
						value = 0
					}
					# Save result to a global var, performance enhancing code
					if = {
						# monarchy vs republic
						limit = {
							global_var:frankfurt_parliament_current_vote = 1
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_republic = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_republic_var
						}
						else = {
							set_global_variable = frankfurt_parliament_has_majority_for_monarchy_var
						}
					}
					if = {
						# voting laws
						limit = {
							global_var:frankfurt_parliament_current_vote = 2
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_oligarchy = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_oligarchy_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_wealth = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_wealth_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_universal = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_universal_var
						}
					}
					if = {
						# parliamentary vs presidential republic - conditional
						limit = {
							global_var:frankfurt_parliament_current_vote = 3
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_presidential_republic = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_presidential_republic_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_parliamentary_republic = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_parliamentary_republic_var
						}
					}
					if = {
						# What is the German fatherland?
						limit = {
							global_var:frankfurt_parliament_current_vote = 4
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_lesser_germany = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_lesser_germany_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_greater_germany = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_greater_germany_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_greater_austria = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_greater_austria_var
						}
					}
					if = {
						# internal vs external focus - only for radical republics
						limit = {
							global_var:frankfurt_parliament_current_vote = 5
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_internal_focus = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_internal_focus_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_external_focus = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_external_focus_var
						}
					}
					change_global_variable = {
						name = frankfurt_parliament_current_vote
						add = 1
					}
					if = {
						limit = {
							# The presidential/parliamentary debate only takes place if republic and wealth voting won
							OR = {
								has_global_variable = frankfurt_parliament_has_majority_for_monarchy_var
								NOT = {
									has_global_variable = frankfurt_parliament_has_majority_for_wealth_var
								}
							}
							global_var:frankfurt_parliament_current_vote = 3
						}
						# Skip it if those 2 are NOT true
						change_global_variable = {
							name = frankfurt_parliament_current_vote
							add = 1
						}
					}
					if = {
						limit = {
							# The revolutionary focus debate only takes place if republic and universal voting won
							OR = {
								has_global_variable = frankfurt_parliament_has_majority_for_monarchy_var
								NOT = {
									has_global_variable = frankfurt_parliament_has_majority_for_universal_var
								}
							}
							global_var:frankfurt_parliament_current_vote = 5
						}
						# Skip it if those 2 are NOT true
						change_global_variable = {
							name = frankfurt_parliament_current_vote
							add = 1
						}
					}
				}
			}
		}
	}
	complete = {
		# Complete on voting round 7, round 6 is the last chance for countries to leave
		custom_tooltip = {
			text = frankfurt_parliament_is_over_tt
			has_global_variable = frankfurt_parliament_current_vote
			global_var:frankfurt_parliament_current_vote = 7
		}
	}
	on_complete = {
		change_global_variable = {
			name = frankfurt_eligible_german_leader_voters
			add = 1
		}
		p:x11C0A0.owner = {
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_1
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_2
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_3
				value = 0
			}
			# Get 3 big (independent) German powers, probably Prussia, Austria and Bavaria?
			# Austria wont be selected if Lesser Germany wins
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
					OR = {
						is_subject = no
						is_subject_type = subject_type_customs_union
					}
					trigger_if = {
						limit = {
							has_global_variable = frankfurt_parliament_has_majority_for_lesser_germany_var
							exists = c:AUS
						}
						c:AUS != this
					}
				}
				order_by = gdp
				position = 0
				set_variable = first_candidate_german_leader
			}
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
					OR = {
						is_subject = no
						is_subject_type = subject_type_customs_union
					}
					trigger_if = {
						limit = {
							has_global_variable = frankfurt_parliament_has_majority_for_lesser_germany_var
							exists = c:AUS
						}
						c:AUS != this
					}
				}
				order_by = gdp
				position = 1
				set_variable = second_candidate_german_leader
			}
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
					OR = {
						is_subject = no
						is_subject_type = subject_type_customs_union
					}
					trigger_if = {
						limit = {
							has_global_variable = frankfurt_parliament_has_majority_for_lesser_germany_var
							exists = c:AUS
						}
						c:AUS != this
					}
				}
				order_by = gdp
				position = 2
				set_variable = third_candidate_german_leader
			}
		}
		set_variable = frankfurt_parliament_voting_for_gutter_king
		trigger_event = {
			id = frankfurt_parliament.1
			days = 3
		}
	}
	goal_add_value = {
		add = 12
	}
	progressbar = yes
	weight = 5000
	should_be_pinned_by_default = yes
}

je_imperia_frankfurt_german_consolidation_gutter_king = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	scripted_button = je_frankfurt_gutter_king_start_sway_button
	scripted_button = je_frankfurt_gutter_king_solidify_sway_button
	scripted_button = je_frankfurt_gutter_king_complete_sway_button
	immediate = {
		# Initialise the JE value; hit 0 for failure and 100 for success (For Gutter King)
		set_variable = {
			name = je_imperia_frankfurt_german_consolidation_gutter_king_value
			value = 0
		}
		trigger_event = {
			# The _initialised variable is set in this event; allows for the possible failure
			# Also sets the _value variable to 50, so its effectively in the middle from the start
			# Well, 1 day after the JE fires anyways. Janky, but couldnt see other options for the implementation I wanted
			# - Danarca
			id = frankfurt_parliament.7
			days = 1
		}
	}
	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					frankfurt_parliament_gutter_king_is_consolidating = yes
				}
				change_variable = {
					name = je_imperia_frankfurt_german_consolidation_gutter_king_value
					add = {
						value = gutter_king_ratio_over_gutter_german_claims
						subtract = 0.75
						multiply = 4
					}
				}
				# Set a global variable for localisation, performance enhancing code
				set_global_variable = {
					name = frankfurt_parliament_gutter_king_is_consolidating_var
					value = 1
				}
			}
			else = {
				change_variable = {
					name = je_imperia_frankfurt_german_consolidation_gutter_king_value
					# Add since the resulting number is negative
					add = {
						value = gutter_king_ratio_over_gutter_german_claims
						# Ratio is always between 0 and .75 here
						subtract = 0.75
						# So now its MAX zero
						multiply = 1.333
						# This was found through.. Too many spreadsheets. Needs more 3's on the end, but it works well enough
					}
				}
				# Set a global variable for localisation, performance enhancing code
				set_global_variable = {
					name = frankfurt_parliament_gutter_king_is_consolidating_var
					value = 0
				}
			}
			round_variable = {
				name = je_imperia_frankfurt_german_consolidation_gutter_king_value
				nearest = 0.05
			}
		}
	}
	complete = {
		custom_tooltip = {
			text = frankfurt_germany_fully_consolidated_tt
			root.var:je_imperia_frankfurt_german_consolidation_gutter_king_value >= 100
		}
	}
	on_complete = {
		hidden_effect = {
			if = {
				limit = {
					has_global_variable = frankfurt_parliament_has_majority_for_greater_germany_var
					exists = c:AUS
					OR = {
						c:AUS = root
						c:AUS = {
							is_subject_of = root
						}
					}
				}
				imperia_frankfurt_parliament_shatter_austria = yes
			}
		}
		custom_tooltip = {
			text = frankfurt_germany_consolidates_tt
			if = {
				limit = {
					country_has_primary_culture = cu:north_german
				}
				every_subject_or_below = {
					limit = {
						country_has_primary_culture = cu:north_german
					}
					root = {
						annex = prev
					}
				}
			}
			if = {
				limit = {
					country_has_primary_culture = cu:south_german
				}
				every_subject_or_below = {
					limit = {
						country_has_primary_culture = cu:south_german
					}
					root = {
						annex = prev
					}
				}
			}
			change_tag = GER
			# Sets the flag to be the Black-Red-Gold
			# Should NOT be cleaned
			set_variable = gutter_germany
		}
		add_modifier = {
			name = crown_from_the_gutter
			years = 20
			is_decaying = yes
		}
		every_state_region = {
			# And just in case someone dipped from the parliament JE, or wasnt invited due to having a proper overlord
			# Add a claim on them. Only for states in the gutter german definition
			limit = {
				any_scope_state = {
					frankfurt_parliament_state_is_gutter_german = yes
					NOT = {
						has_claim_by = root
					}
				}
			}
			add_claim = root
		}
	}
	fail = {
		custom_tooltip = {
			text = frankfurt_germany_fully_stamped_out_tt
			root.var:je_imperia_frankfurt_german_consolidation_gutter_king_value <= 0
			has_variable = je_imperia_frankfurt_german_consolidation_gutter_king_value_initialised
		}
	}
	on_fail = {
		imperia_frankfurt_parliament_dissolve_gutter_germany = yes
	}
	current_value = {
		value = root.var:je_imperia_frankfurt_german_consolidation_gutter_king_value
	}
	goal_add_value = {
		add = 100
	}
	on_timeout = {
		imperia_frankfurt_parliament_dissolve_gutter_germany = yes
	}
	# JE will run for 5 years, if balance is still maintained at that point (unlikely).. Fail it
	progressbar = yes
	timeout = 1826
	weight = 5000
	should_be_pinned_by_default = yes
}

je_imperia_frankfurt_german_consolidation_german_major = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	scripted_button = je_frankfurt_german_major_start_sway_button
	scripted_button = je_frankfurt_german_major_solidify_sway_button
	scripted_button = je_frankfurt_german_major_complete_sway_button
	immediate = {
		random_country = {
			limit = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
			save_scope_as = gutter_king_scope
		}
	}
	complete = {
		custom_tooltip = {
			text = frankfurt_germany_fully_stamped_out_tt
			scope:gutter_king_scope.var:je_imperia_frankfurt_german_consolidation_gutter_king_value <= 0
		}
		scope:gutter_king_scope = {
			NOT = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
		}
	}
	fail = {
		custom_tooltip = {
			text = frankfurt_germany_fully_consolidated_tt
			scope:gutter_king_scope.var:je_imperia_frankfurt_german_consolidation_gutter_king_value >= 100
		}
		scope:gutter_king_scope = {
			NOT = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
		}
	}
	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = je_imperia_frankfurt_german_consolidation_german_major_status
			}
		}
	}
}

je_imperia_frankfurt_german_consolidation_german_minor = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	immediate = {
		random_country = {
			limit = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
			save_scope_as = gutter_king_scope
		}
	}
	complete = {
		custom_tooltip = {
			text = frankfurt_germany_fully_stamped_out_tt
			scope:gutter_king_scope.var:je_imperia_frankfurt_german_consolidation_gutter_king_value <= 0
		}
		scope:gutter_king_scope = {
			NOT = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
		}
	}
	on_complete = {
		if = {
			limit = {
				has_modifier = gutter_king_start_sway
			}
			remove_modifier = gutter_king_start_sway
			add_modifier = {
				name = gutter_king_start_sway
				years = 5
				is_decaying = yes
			}
		}
		if = {
			limit = {
				has_modifier = gutter_king_solid_sway
			}
			remove_modifier = gutter_king_solid_sway
			add_modifier = {
				name = gutter_king_solid_sway
				years = 5
				is_decaying = yes
			}
		}
		if = {
			limit = {
				has_modifier = gutter_king_complete_sway
			}
			remove_modifier = gutter_king_complete_sway
			add_modifier = {
				name = gutter_king_complete_sway
				years = 5
				is_decaying = yes
			}
		}
		if = {
			limit = {
				has_modifier = german_major_start_sway
			}
			remove_modifier = german_major_start_sway
			add_modifier = {
				name = german_major_start_sway
				years = 5
				is_decaying = yes
			}
		}
		if = {
			limit = {
				has_modifier = german_major_solid_sway
			}
			remove_modifier = german_major_solid_sway
			add_modifier = {
				name = german_major_solid_sway
				years = 5
				is_decaying = yes
			}
		}
		if = {
			limit = {
				has_modifier = german_major_complete_sway
			}
			remove_modifier = german_major_complete_sway
			add_modifier = {
				name = german_major_complete_sway
				years = 5
				is_decaying = yes
			}
		}
	}
	fail = {
		custom_tooltip = {
			text = frankfurt_germany_fully_consolidated_tt
			scope:gutter_king_scope.var:je_imperia_frankfurt_german_consolidation_gutter_king_value >= 100
		}
		scope:gutter_king_scope = {
			NOT = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
		}
	}
	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = je_imperia_frankfurt_german_consolidation_german_minor_status
			}
		}
	}
}
