je_imperia_frankfurt_parliament = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	# Voting Starting Options
	scripted_button = je_frankfurt_parliament_vote_republic_button
	scripted_button = je_frankfurt_parliament_vote_monarchy_button
	# Who gets to vote in Germany?
	scripted_button = je_frankfurt_parliament_vote_oligarchy_button
	scripted_button = je_frankfurt_parliament_vote_wealth_button
	scripted_button = je_frankfurt_parliament_vote_universal_button
	# Optional round - presidential or parliamentary republic
	scripted_button = je_frankfurt_parliament_vote_presidential_button
	scripted_button = je_frankfurt_parliament_vote_parliamentary_button
	# Claims
	scripted_button = je_frankfurt_parliament_lesser_germany_button
	scripted_button = je_frankfurt_parliament_greater_germany_button
	scripted_button = je_frankfurt_parliament_greater_austria_button
	# Optional round - revolution? Only for universal suffrage republics
	scripted_button = je_frankfurt_parliament_internal_focus_button
	scripted_button = je_frankfurt_parliament_external_focus_button
	# Leave the conference, wont be pressed to join the new Germany
	scripted_button = je_frankfurt_parliament_leave_button
	is_shown_when_inactive = {
		OR = {
			country_has_primary_culture = cu:north_german
			country_has_primary_culture = cu:south_german
		}
	}
	possible = {
		any_country = {
			filter = {
				OR = {
					country_has_primary_culture = cu:north_german
					country_has_primary_culture = cu:south_german
				}
			}
			has_technology_researched = nationalism
			percent >= 0.75
		}
	}
	immediate = {
		# This section pops at the start of the Conference. Used to initialise stuff, like variables
		# Only does so once
		trigger_event = {
			# Announcement
			id = frankfurt_parliament.4
			popup = yes
		}
		if = {
			limit = {
				NOT = {
					exists = global_var:frankfurt_parliament_voting_period
				}
			}
			set_global_variable = {
				name = frankfurt_parliament_voting_period
				value = 0
			}
			set_global_variable = {
				name = frankfurt_parliament_current_vote
				value = 1
			}
			# This one is just initialised here, will be "populated" on completion
			set_global_variable = {
				name = frankfurt_eligible_german_leader_voters
				value = 0
			}
		}
	}
	fail = {
		custom_tooltip = {
			text = left_frankfurt_parliament_tt
			has_variable = left_frankfurt_parliament
		}
	}
	current_value = {
		value = global_var:frankfurt_parliament_voting_period
	}
	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					this = p:x11C0A0.owner
				}
				change_global_variable = {
					name = frankfurt_parliament_voting_period
					add = 1
				}
				## If the voting has run for 12 weeks, start over with a new vote category
				if = {
					limit = {
						global_var:frankfurt_parliament_voting_period >= 12
					}
					set_global_variable = {
						name = frankfurt_parliament_voting_period
						value = 0
					}
					# Save result to a global var, performance enhancing code
					if = {
						# monarchy vs republic
						limit = {
							global_var:frankfurt_parliament_current_vote = 1
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_republic = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_republic_var
						}
						else = {
							set_global_variable = frankfurt_parliament_has_majority_for_monarchy_var
						}
					}
					if = {
						# voting laws
						limit = {
							global_var:frankfurt_parliament_current_vote = 2
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_oligarchy = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_oligarchy_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_wealth = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_wealth_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_universal = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_universal_var
						}
					}
					if = {
						# parliamentary vs presidential republic - conditional
						limit = {
							global_var:frankfurt_parliament_current_vote = 3
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_presidential_republic = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_presidential_republic_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_parliamentary_republic = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_parliamentary_republic_var
						}
					}
					if = {
						# What is the German fatherland?
						limit = {
							global_var:frankfurt_parliament_current_vote = 4
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_lesser_germany = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_lesser_germany_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_greater_germany = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_greater_germany_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_greater_austria = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_greater_austria_var
						}
					}
					if = {
						# internal vs external focus - only for radical republics
						limit = {
							global_var:frankfurt_parliament_current_vote = 5
						}
						if = {
							limit = {
								frankfurt_parliament_has_majority_for_internal_focus = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_internal_focus_var
						}
						else_if = {
							limit = {
								frankfurt_parliament_has_majority_for_external_focus = yes
							}
							set_global_variable = frankfurt_parliament_has_majority_for_external_focus_var
						}
					}
					change_global_variable = {
						name = frankfurt_parliament_current_vote
						add = 1
					}
					if = {
						limit = {
							# The presidential/parliamentary debate only takes place if republic and wealth voting won
							OR = {
								has_global_variable = frankfurt_parliament_has_majority_for_monarchy_var
								NOT = {
									has_global_variable = frankfurt_parliament_has_majority_for_wealth_var
								}
							}
							global_var:frankfurt_parliament_current_vote = 3
						}
						# Skip it if those 2 are NOT true
						change_global_variable = {
							name = frankfurt_parliament_current_vote
							add = 1
						}
					}
					if = {
						limit = {
							# The revolutionary focus debate only takes place if republic and universal voting won
							OR = {
								has_global_variable = frankfurt_parliament_has_majority_for_monarchy_var
								NOT = {has_global_variable = frankfurt_parliament_has_majority_for_universal_var}
							}
							global_var:frankfurt_parliament_current_vote = 5
						}
						# Skip it if those 2 are NOT true
						change_global_variable = {
							name = frankfurt_parliament_current_vote
							add = 1
						}
					}
				}
			}
		}
	}
	complete = {
		# Complete on voting round 7, round 6 is the last chance for countries to leave
		custom_tooltip = {
			text = frankfurt_parliament_is_over_tt
			global_var:frankfurt_parliament_current_vote = 7
		}
	}
	on_complete = {
		change_global_variable = {
			name = frankfurt_eligible_german_leader_voters
			add = 1
		}
		p:x11C0A0.owner = {
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_1
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_2
				value = 0
			}
			set_global_variable = {
				name = frankfurt_has_voted_for_german_leader_3
				value = 0
			}
			# Get 3 big German powers, probably Prussia, Austria and Bavaria?
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
				}
				order_by = gdp
				position = 0
				set_variable = first_candidate_german_leader
			}
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
				}
				order_by = gdp
				position = 1
				set_variable = second_candidate_german_leader
			}
			ordered_country = {
				limit = {
					OR = {
						country_has_primary_culture = cu:north_german
						country_has_primary_culture = cu:south_german
					}
				}
				order_by = gdp
				position = 2
				set_variable = third_candidate_german_leader
			}
		}
		trigger_event = {
			id = frankfurt_parliament.1
			days = 3
		}
	}
	goal_add_value = {
		add = 12
	}
	progressbar = yes
	weight = 5000
	should_be_pinned_by_default = yes
}

je_imperia_frankfurt_german_consolidation_gutter_king = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	scripted_button = je_frankfurt_gutter_king_sway_button
	immediate = {
		# Initialise the JE value; hit 0 for failure and 100 for success (For Gutter King)
		set_variable = {
			name = je_imperia_frankfurt_german_consolidation_gutter_king_value
			value = 50
		}
	}
	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					frankfurt_parliament_gutter_king_is_consolidating = yes
				}
				change_variable = {
					name = je_imperia_frankfurt_german_consolidation_gutter_king_value
					add = 1
				}
			}
			else = {
				change_variable = {
					name = je_imperia_frankfurt_german_consolidation_gutter_king_value
					subtract = 1
				}
			}
		}
	}
	complete = {
		custom_tooltip = {
			text = frankfurt_germany_fully_consolidated_tt
			root.var:je_imperia_frankfurt_german_consolidation_gutter_king_value >= 100
		}
	}
	on_complete = {
		custom_tooltip = {
			text = frankfurt_germany_consolidates_tt
			every_subject_or_below = {
				root = {
					annex = prev
				}
			}
			change_tag = GER
			set_variable = gutter_germany			# Sets the flag to be the Black-Red-Gold
		}
		every_state_region = {
			limit = {
				any_scope_state = {
					frankfurt_parliament_state_is_gutter_german = yes
					NOT = {
						has_claim_by = root
					}
				}
			}
			add_claim = root
		}
	}
	fail = {
		custom_tooltip = {
			text = frankfurt_germany_fully_stamped_out_tt
			root.var:je_imperia_frankfurt_german_consolidation_gutter_king_value <= 0
		}
	}
	on_fail = {
		custom_tooltip = {
			text = frankfurt_return_to_old_status_tt
			every_subject_or_below = {
				limit = {
					is_direct_subject_of = root
				}
				remove_modifier = gutter_king_prestige_positive
				make_independent = yes
				if = {
					limit = {
						has_variable = frankfurt_parliament_original_overlord
					}
					var:frankfurt_parliament_original_overlord = {
						create_diplomatic_pact = {
							country = prev
							type = customs_union
						}
					}
				}
			}
		}
		if = {
			limit = {
				exists = var:gutter_king_old_lawgroup_governance_principles
			}
			activate_law = var:gutter_king_old_lawgroup_governance_principles
		}
		if = {
			limit = {
				exists = var:gutter_king_old_lawgroup_distribution_of_power
			}
			activate_law = var:gutter_king_old_lawgroup_distribution_of_power
		}
		if = {
			limit = {
				exists = var:gutter_king_old_lawgroup_diplomatic_stance
			}
			activate_law = var:gutter_king_old_lawgroup_diplomatic_stance
		}
	}
	current_value = {
		value = root.var:je_imperia_frankfurt_german_consolidation_gutter_king_value
	}
	goal_add_value = {
		add = 50
	}
	on_timeout = {
		custom_tooltip = {
			text = frankfurt_return_to_old_status_tt
			every_subject_or_below = {
				limit = {
					is_direct_subject_of = root
				}
				remove_modifier = gutter_king_prestige_positive
				make_independent = yes
				if = {
					limit = {
						has_variable = frankfurt_parliament_original_overlord
					}
					var:frankfurt_parliament_original_overlord = {
						create_diplomatic_pact = {
							country = prev
							type = customs_union
						}
					}
				}
			}
		}
	}
	# JE will run for 5 years, if balance is still maintained at that point.. Fail it
	progressbar = yes
	timeout = 1826
	weight = 5000
	should_be_pinned_by_default = yes
}

je_imperia_frankfurt_german_consolidation_german_major = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	scripted_button = je_frankfurt_german_major_sway_button
	immediate = {
		random_country = {
			limit = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
			save_scope_as = gutter_king_scope
		}
		set_relations = {
			country = scope:gutter_king_scope
			value = -50
		}
	}
	complete = {
		custom_tooltip = {
			text = frankfurt_germany_fully_stamped_out_tt
			scope:gutter_king_scope.var:je_imperia_frankfurt_german_consolidation_gutter_king_value <= 0
		}
		scope:gutter_king_scope = {
			NOT = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
		}
	}
	fail = {
		custom_tooltip = {
			text = frankfurt_germany_fully_consolidated_tt
			scope:gutter_king_scope.var:je_imperia_frankfurt_german_consolidation_gutter_king_value >= 100
		}
		scope:gutter_king_scope = {
			NOT = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
		}
	}
	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = je_imperia_frankfurt_german_consolidation_german_major_status
			}
		}
	}
}

je_imperia_frankfurt_german_consolidation_german_minor = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	group = je_group_historical_content
	immediate = {
		random_country = {
			limit = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
			save_scope_as = gutter_king_scope
		}
	}
	complete = {
		custom_tooltip = {
			text = frankfurt_germany_fully_stamped_out_tt
			scope:gutter_king_scope.var:je_imperia_frankfurt_german_consolidation_gutter_king_value <= 0
		}
		scope:gutter_king_scope = {
			NOT = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
		}
	}
	fail = {
		custom_tooltip = {
			text = frankfurt_germany_fully_consolidated_tt
			scope:gutter_king_scope.var:je_imperia_frankfurt_german_consolidation_gutter_king_value >= 100
		}
		scope:gutter_king_scope = {
			NOT = {
				has_journal_entry = je_imperia_frankfurt_german_consolidation_gutter_king
			}
		}
	}
	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = je_imperia_frankfurt_german_consolidation_german_minor_status
			}
		}
	}
}
